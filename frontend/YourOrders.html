<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">      <!-- The code up here is used on almost every HTML file -->
        <title>WSU-Marketshare </title>
        <link rel="stylesheet" href="YourOrder.css">       <!-- This code connects my cascade style sheets to the webpage -->

        <link rel="preconnect" href="https://fonts.googleapis.com">   <!--for more graphocs and designs-->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

        <link href="https://fonts.googleapis.com/css2?family=Freeman&display=swap" rel="stylesheet">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> <!--from teammates code for the header-->
    </head>
    <body>
                <!--NavBar code from teammates start-->
                <body>
                    <nav
                      class="navbar navbar-expand-lg"
                      style="background-color: rgb(8, 98, 8) !important"
                    >
                      <div class="container-fluid">
                        <div class="button-container">
                          <a href="#top">
                            <button id="MainButton">
                              <img
                                src="images/Warriors.png"
                                alt="Logo"
                                width="30"
                                height="24"
                                class="d-inline-block align-text-top"
                              />
                            </button>
                            <div class="hover-message">
                              Home
                              <i class="fa-solid fa-house" id="HomeIcon"></i>
                            </div>
                          </a>
                        </div>
                        <i class="fa-solid fa-user" id="ProfileIcon"></i>
                        <button
                          class="navbar-toggler"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#navbarSupportedContent"
                          aria-controls="navbarSupportedContent"
                          aria-expanded="false"
                          aria-label="Toggle navigation"
                        >
                          <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                              <a class="nav-link active" aria-current="page" href="Profile.html"
                                >Profile</a
                              >
                            </li>
                            <i class="fa-solid fa-bell"></i>
                            <li class="nav-item">
                              <a class="nav-link" href="Sellpageintro.html">Sell</a>
                            </li>
                            <i class="fa-solid fa-cart-shopping" id="i4"></i>
                            <li class="nav-item">
                              <a class="nav-link" href="Cart.html">Cart</a>
                            </li>
                            <i class="fa-solid fa-gear" id="i5"></i>
                            <li class="nav-item">
                              <a class="nav-link" href="#">Settings</a>
                            </li>
                            <i class="fa-solid fa-envelope" id="i3"></i>
                            <li class="nav-item">
                              <a class="nav-link" href="#">Messages</a>
                            </li>
                          </ul>
                          <form class="d-flex w-50">
                            <input
                              class="form-control me-2"
                              type="search"
                              id="searchInput"
                              placeholder="Search products..."
                              aria-label="Search"
                            />
                            <button
                              class="btn btn-outline-success"
                              id="RightButton"
                              type="button"
                            >
                              <i class="fa-solid fa-magnifying-glass" id="searchicon"></i>
                            </button>
                          </form>
                        </div>
                      </div>
                    </nav>
                
                    <h3 id="NavText">WSU Marketplace</h3>
                <!--NavBar code ends-->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> <!--Part of the NavBar code-->


                <div class="order-container">
                    <h1>Your Orders:</h1>
                    <p id="no-orders-message">You currently have no orders</p>
                    <div id="orders-list">
                        <!--here are where the orders will be-->
                    </div>
                </div>
                <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script> 
                <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
                <script>
                  const firebaseConfig = {
                   apiKey: "AIzaSyDylHe_iXex8F3He6Ez4P49OmLPQMQ_J6k",
                   authDomain: "sell-25f45.firebaseapp.com",
                   projectId: "sell-25f45",
                   storageBucket: "sell-25f45.firebasestorage.app",
                   messagingSenderId: "953873344669",
                   appId: "1:953873344669:web:7b55ea629c5397a72a0c74",
                   measurementId: "G-9DB3NVDSQJ"
                  };
                  const app= firebase.initializeApp(firebaseConfig);
                  const dp = firebase.firestore();

                  class Orders {
                    constructor(){
                      this.userId = "current_user";
                      this.init();

                    }
                    init(){
                      this.fetchOrders();
                    }
                    fetchOrders(){
                      db.collection("orders").doc(this.userId).collection("userOrders").orderBy("timestamp", "desc").onSnapshot((snapchot) =>{
                        const orderList = document.getElementById('orders-list');
                        const noOrdersMessage = document.getElementById('no-orders-message');
                        orderList.innerHTML = '';
                        if(snapchot.empty){
                          noOrdersMessage.style.display = 'block';
                        }
                        else{
                          noOrdersMessage.style.display = 'none';
                          snapshot.forEach((doc) =>{
                            const orderData = doc.data();
                          const orderElement = this.createOrderElement(orderData);
                          orderList.appendChild(orderElement);

                          });
                         
                        }

                      });
                    }
                    createOrderElement(orderData){
                      const orderElement = document.createElement('div');
                      orderElement.classList.add('order-item');
                      
                      const orderDate = orderData.timestamp ? orderData.timestamp.toDate().toLocaleString() : 'Unkown date';
                      orderElement.innerHTML = `
                    <h2>Order Placed on: ${orderDate}</h2>
                    <div class="order-items">
                        ${orderData.items.map(item => `
                            <div class="order-item-details">
                                <img src="${item.image}" alt="${item.name}" class="item-image">
                                <div class="item-info">
                                    <h3>${item.name}</h3>
                                    <p>Price: $${item.price.toFixed(2)}</p>
                                    <p>Quantity: ${item.quantity}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                return orderElement;
                    }
                  }


                </script>

    </body>

    </html>